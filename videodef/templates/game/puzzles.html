{% extends 'base.html' %} 
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/game/puzzles.css' %}" />
<link rel="stylesheet" href="{% static 'css/game/game_settings_panel.css' %}" />
<link rel="stylesheet" href="{% static 'css/game/game_load_window.css' %}" />
{% endblock %}

{% block page_name %}Пазлы{% endblock %}

{% block content %}
<div class="puzzle-page-wrapper">
    <!-- Левая часть: доска с пазлом -->
    <div id="puzzle-wrapper" class="puzzle-wrapper">
        <!--Здесь скрипт вставит пазл-->
    </div>

    <div id="puzzles-settings" class="game-settings-panel">
        <div class="settings-content-inner">
            <h2>Настройки пазла</h2>

            <!-- Имя для сохранения -->
            <label for="puzzle-name">Название для сохранения:</label>
            <input type="text" id="puzzle-name" placeholder="Название пазла">

            <h3>Выберите изображение для пазла</h3>

            <div class="presets-container">
                <img src="{% static 'images/british-cat.jpg' %}" class="preset" data-src="{% static 'images/british-cat.jpg' %}" alt="Британский кот">
                <img src="{% static 'images/tree.png' %}" class="preset" data-src="{% static 'images/tree.png' %}" alt="Дерево">
            </div>

            <!-- Загрузка пользовательского изображения -->
            <label class="upload-label">
                Загрузить своё:
            </label>
            <input type="file" id="custom-image" accept="image/*">
            
            <div id="image-preview-container" class="image-preview-container" style="display: none;">
                <img id="image-preview" src="#" alt="Предпросмотр">
                <p id="image-preview-text">Используется загруженное изображение.</p>
            </div>

            <!-- Выбор сложности пазла -->
            <label for="difficulty">Выберите сложность:</label>
            <select id="difficulty">
                <option value="2" selected>2x2</option>
                <option value="3">3x3</option>
                <option value="4">4x4</option>
            </select>

            <!-- Кнопки управления -->
            <div class="settings-buttons">
                <button id="start-game">Начать игру</button>
                <button id="save-puzzle-btn">Сохранить</button>
                <button id="load-puzzle-btn">Загрузить</button>
           </div>
        </div>
    </div>
</div>

<!-- Модальное окно для загрузки пазлов -->
<div id="load-puzzle-modal" class="modal-overlay" style="display: none;">
    <div class="modal-container">
        <h2>Выберите сохраненный пазл</h2>
        <div id="load-list-container">
            <!-- Сюда JS добавит список пазлов -->
            <p>Загрузка...</p>
        </div>
        <div class="modal-buttons">
            <button id="load-confirm-btn" disabled>Загрузить выбранный</button>
            <button id="load-cancel-btn">Отмена</button>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script>
    const isAuthenticated = {% if request.user.is_authenticated %}true{% else %}false{% endif %};
    const loginUrl = "{% url 'account:login' %}?next=" + window.location.pathname;
    const savePuzzleUrl = "{% url 'game:save_puzzle' %}";
    const updatePuzzleBaseUrl = "{% url 'game:update_puzzle' game_id="0" %}".replace('/0/', '/'); 
    const loadPuzzlesUrl = "{% url 'game:load_puzzles' %}";
    const csrfToken = "{{ csrf_token }}";
    const images = "{% static 'images' %}";
</script>
<script src="{% static 'js/game/puzzle.bundle.js' %}"></script>
<!-- Инициализация игры после загрузки DOM -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Убедитесь, что эта функция существует в puzzle.bundle.js
        if(typeof createPuzzleSeparately === 'function') {
            createPuzzleSeparately();
        } else {
            console.error("Функция createPuzzleSeparately не найдена.");
        }
    });
</script>
{% endblock %}