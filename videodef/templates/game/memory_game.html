{% extends 'base.html' %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/game/memory_game.css' %}" />
<link rel="stylesheet" href="{% static 'css/game/game_settings_panel.css' %}" />
<link rel="stylesheet" href="{% static 'css/game/game_load_window.css' %}" />
{% endblock %}

{% block page_name %}–ü–æ–∏—Å–∫ –ø–∞—Ä{% endblock %}

{% block content %}
<div class="memory-page-wrapper">
    <!-- –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
    <div id="memory-game-area" class="memory-game-area">
        <div id="memory-game-wrapper" class="memory-game-wrapper">
            <p class="initial-message">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É".</p>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–≥—Ä—ã -->
    <div id="memory-game-settings" class="game-settings-panel">
        <div class="settings-content-inner">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h2>
            <label for="game-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</label>
            <input type="text" id="game-name" placeholder="–ú–æ—è –∏–≥—Ä–∞ –≤ –ø–∞—Ä—ã">
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫:</h3>
            <div class="presets-container">
                <div class="preset-set" data-set-name="fruits">–§—Ä—É–∫—Ç—ã üçì</div>
                <div class="preset-set" data-set-name="animals">–ñ–∏–≤–æ—Ç–Ω—ã–µ üêº</div>
            </div>
            <label for="custom-images-input" class="upload-label">
                –ò–õ–ò –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
            </label>
            <input type="file" id="custom-images-input" accept="image/*" multiple>
            <div id="custom-images-preview" class="image-preview-container" style="display: none;">
                <p id="custom-images-info-text">–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: <span id="custom-images-count">0</span></p>
                <div class="preview-grid"></div>
            </div>
            <label for="pair-count-select">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä:</label>
            <select id="pair-count-select">
                <option value="2">2 –ø–∞—Ä—ã</option>
                <option value="3">3 –ø–∞—Ä—ã</option>
                <option value="4" selected>4 –ø–∞—Ä—ã</option>
                <option value="5">5 –ø–∞—Ä—ã</option>
                <option value="6">6 –ø–∞—Ä</option> 
            </select>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π -->
            <div class="settings-buttons">
                <button id="start-memory-game">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button id="save-memory-game-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="load-memory-game-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä —Ç–∏–ø–∞ '–ü–æ–∏—Å–∫ –ø–∞—Ä' -->
<div id="load-game-modal" class="modal-overlay" style="display: none;">
    <div class="modal-container">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É</h2>
        <div id="load-list-container">
            <!-- –°—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç —Å–ø–∏—Å–æ–∫ –∏–≥—Ä -->
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
        <div class="modal-buttons">
            <button id="load-confirm-btn" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π</button>
            <button id="load-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const isAuthenticated = {% if request.user.is_authenticated %}true{% else %}false{% endif %};
    const loginUrl = "{% url 'login' %}?next=" + window.location.pathname;
    const presetImagesBasePath = "{% static 'images/memory_game_presets/' %}"; 
    const saveMemoryGameUrl = "{% url 'save_memory_game' %}";
    const loadMemoryGamesUrl = "{% url 'load_memory_games' %}";
    const updateMemoryGameBaseUrl = "{% url 'update_memory_game' game_id=0 %}"; 
    const csrfToken = "{{ csrf_token }}";
</script>
<script src="{% static 'js/game/memory_game.bundle.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof window.MemoryGameModule !== 'undefined' && typeof window.MemoryGameModule.createMemoryGameSeparately === 'function') {
            window.MemoryGameModule.createMemoryGameSeparately();
        } else {
            console.error("–§—É–Ω–∫—Ü–∏—è createMemoryGameSeparately –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");
        }
    });
</script>
{% endblock %}